# TCP与UDP的区别

TCP协议：全称是传输控制协议是一种面向连接的、可靠的、基于字节流的传输层通信协议，由 IETF 的RFC 793定义。TCP 是面向连接的、可靠的流协议。流就是指不间断的数据结构，你可以把它想象成排水管中的水流。

UDP协议：全称是用户数据报协议，在网络中它与TCP协议一样用于处理数据包，是一种无连接的协议，UDP有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。

TCP和UDP都属于TCP/IP协议簇，位于OSI七层参考模型的传输层。

## TCP协议特点

- 面向连接：发送数据之前必须在两端建立连接。建立连接的方法是三次握手，为数据的可靠传输打下基础。

- 面向字节流：TCP不像UDP那样一个个报文独立传输，而是不保留报文边界的情况下以字节流方式传输。

- 仅支持单播传输：每条TCP传输连接只能有两个端点，只能进行点对点的数据传输，不支持多播和广播的传输方式。

- 全双工通信：TCP允许双方的应用程序在任何时候都能发送数据，TCP可以立即发送一个数据段，也可以缓存一段时间以便一次发送更多的数据段(最大的数据段大小取决于MSS)。

- 可靠性传输：TCP为了保证报文传输的可靠，会给每个包一个序号，序号也保证了传送到接收端实体的包按序接收。然后接收端实体对已成功收到的字节发回一个相应的确认(ACK)；如果发送端实体在合理的往返时延(RTT)内未收到确认，那么对应的数据将会被重传。

- 提供拥塞控制：当网络出现拥塞的时候，TCP能够减小向网络中注入数据的速率和数量，缓解拥塞。

## UDP协议特点

- 面向无连接：UDP不需要像TCP一样在发送数据前进行三次握手，对数据报文只进行搬运，不会进行任何拆分和拼接操作。

  - 在发送端，应用层将数据传递给传输层的 UDP 协议，UDP 只会给数据增加一个 UDP 头标识下是 UDP 协议，然后传递给网络层

  - 在接收端，网络层将数据传递给传输层，UDP 只去除 IP 报文头就传递给应用层，不会任何拼接操作

- 有单播，多播和广播功能：UDP不仅仅支持一对一的传输方式，还支持一对多，多对多，多对一的方式，UDP提供了单播，多播和广播的功能。

- 不可靠性：首先不可靠性体现在无连接上，通信都不需要建立连接，想发就发，这样的情况肯定不可靠。

并且收到什么数据就传递什么数据，并且也不会备份数据，发送数据也不会关心对方是否已经正确接收到数据了。

再者网络环境时好时坏，但是 UDP 因为没有拥塞控制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。

这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求高的场景（比如电话会议）就需要使用 UDP 而不是 TCP。

- 头部开销小：UDP 头部包含了以下几个数据：

  - 两个十六位的端口号，分别为源端口（可选字段）和目标端口

  - 整个数据报文的长度

  - 整个数据报文的检验和（IPv4 可选 字段），该字段用于发现头部信息和数据中的错误

  因此 UDP 的头部开销小，只有八字节，相比 TCP 的至少二十字节要少得多，在传输数据报文时是很高效的

## 两者对比

|       |   UDP  |   TCP  |
| ----- | ------ | ------ |
| 是否连接|	无连接 | 面向连接 |
| 是否可靠|不可靠传输，不使用流量控制和拥塞控制|可靠传输，使用流量控制和拥塞控制|
|连接对象个数|支持一对一，一对多，多对一和多对多交互通信|只能是一对一通信|
|传输方式|	面向报文|	面向字节流|
|首部开销|	首部开销小，仅8字节	| 首部最小20字节，最大60字节|
|适用场景|	适用于实时应用（IP电话、视频会议、直播等）|	适用于要求可靠传输的应用，例如文件传输|

## 总结

- TCP向上层提供面向连接的可靠服务 ，UDP向上层提供无连接不可靠服务。

- 虽然 UDP 并没有 TCP 传输来的准确，但是也能在很多实时性要求高的地方有所作为

- 对数据准确性要求高，速度可以相对较慢的，可以选用TCP

